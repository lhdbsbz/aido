<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aido 管理</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <header class="header">
    <h1>Aido</h1>
    <span class="status" id="status">未连接</span>
    <input type="password" id="token" placeholder="Gateway Token（无则留空）" class="token-input">
    <button id="connectBtn">连接</button>
  </header>

  <nav class="tabs">
    <button class="tab active" data-tab="chat">对话</button>
    <button class="tab" data-tab="sessions">会话</button>
    <button class="tab" data-tab="config">配置</button>
    <button class="tab" data-tab="health">状态</button>
  </nav>

  <main class="content">
    <section id="panel-chat" class="panel active">
      <div class="chat-area">
        <div class="chat-toolbar">
          <span id="currentSessionLabel" class="current-session-label" title="当前会话">—</span>
          <button type="button" id="newSessionBtn" class="chat-toolbar-btn">新会话</button>
          <label class="execution-log-switch">
            <input type="checkbox" id="executionLogSwitch" autocomplete="off">
            <span class="execution-log-switch-slider"></span>
            <span class="execution-log-switch-label">展开执行过程</span>
          </label>
        </div>
        <div id="chatHistory" class="chat-history"></div>
        <div class="chat-input-row">
          <textarea id="chatInput" placeholder="输入消息验证对话..." rows="2"></textarea>
          <button id="sendBtn">发送</button>
        </div>
      </div>
    </section>

    <section id="panel-sessions" class="panel">
      <div class="sessions-toolbar">
        <button id="refreshSessions">刷新</button>
      </div>
      <div id="sessionsList" class="sessions-list"></div>
    </section>

    <section id="panel-config" class="panel">
      <div class="config-toolbar">
        <button id="refreshConfig">刷新</button>
        <button id="saveConfig" class="config-save-btn">保存</button>
      </div>
      <p id="configMessage" class="config-message"></p>
      <p class="config-path-hint">配置文件路径：<span id="configPathDisplay"></span></p>

      <div class="config-layout">
        <nav class="config-nav">
          <a href="#config-section-gateway" class="config-nav-item">网关</a>
          <a href="#config-section-agents" class="config-nav-item">Agents</a>
          <a href="#config-section-providers" class="config-nav-item">Providers</a>
          <a href="#config-section-tools" class="config-nav-item">工具 MCP</a>
          <a href="#config-section-bridges" class="config-nav-item">Bridges</a>
        </nav>
        <div class="config-body">
      <div id="config-section-gateway" class="config-section">
        <h3 class="config-section-title">网关</h3>
        <div class="config-form">
          <label>端口 <input type="number" id="configGatewayPort" min="1" max="65535" placeholder="19800"></label>
          <label>当前 Agent <input type="text" id="configGatewayCurrentAgent" data-input-select="gateway-current-agent-list" autocomplete="off" placeholder="如 default"><span class="config-hint-inline">固定使用该 agent；可输入或从列表选</span></label>
          <datalist id="gateway-current-agent-list"></datalist>
          <label>Tools Profile <input type="text" id="configGatewayToolsProfile" data-input-select="gateway-tools-profile-list" autocomplete="off" placeholder="coding"><span class="config-hint-inline">全局工具集档位；可输入或选 minimal/coding/messaging/full</span></label>
          <datalist id="gateway-tools-profile-list"><option value="minimal"><option value="coding"><option value="messaging"><option value="full"></datalist>
          <label>提示词语言
            <select id="configGatewayLocale">
              <option value="zh">中文</option>
              <option value="en">English</option>
            </select>
            <span class="config-hint-inline">系统提示词与摘要使用的语言，默认中文</span>
          </label>
          <label>认证 Token <input type="text" id="configGatewayToken" placeholder="可选，无则留空表示不校验"></label>
        </div>
      </div>

      <div id="config-section-agents" class="config-section">
        <h3 class="config-section-title">Agents</h3>
        <p class="config-section-hint">可配置多个；每个 agent 绑定一个 provider。当前使用哪个 agent 在「网关 → 当前 Agent」里指定。</p>
        <div id="configAgents"></div>
        <button type="button" id="configAgentAdd" class="config-add-btn">添加 Agent</button>
      </div>

      <div id="config-section-providers" class="config-section">
        <h3 class="config-section-title">Providers</h3>
        <p class="config-section-hint">可配置多个；baseURL 与 type 已为常见服务填好，只需填 API Key。可自行增加 provider。</p>
        <div id="configProviders"></div>
        <button type="button" id="configProviderAdd" class="config-add-btn">添加 Provider</button>
      </div>

      <div id="config-section-tools" class="config-section">
        <h3 class="config-section-title">工具 MCP（Tools）</h3>
        <div id="configMCP"></div>
        <button type="button" id="configMCPAdd" class="config-add-btn">添加 MCP 服务</button>
      </div>
      <div id="config-section-bridges" class="config-section">
        <h3 class="config-section-title">Bridges（桥接器）</h3>
        <p class="config-section-hint">随 Aido 启动自动拉起的平台桥接器；path 相对配置文件所在目录或绝对路径。AIDO_WS_URL、AIDO_TOKEN 由主程序注入。</p>
        <div id="configBridges"></div>
        <button type="button" id="configBridgeAdd" class="config-add-btn">添加 Bridge</button>
      </div>
        </div>
      </div>
    </section>

    <section id="panel-health" class="panel">
      <pre id="healthInfo" class="health-info">点击连接后查看</pre>
    </section>
  </main>

  <script src="/static/app.js"></script>
</body>
</html>
